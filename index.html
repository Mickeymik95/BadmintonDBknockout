<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>BWF BADMINTON KELUARGA¬≤ SUPER SERIES 10</title>
<style>
    :root { 
        --menang: #2ecc71; --kalah: #e74c3c; --utama: #00d2ff; 
        --emas: #ffd700; --bg: #0b0b0d; --kad: #1a1a1f; 
        --biru-nombor: #00e5ff; --garis: #333;
    }
    
    body { font-family:'Segoe UI', sans-serif; background:var(--bg); color:#fff; padding:20px; margin:0; }
    
    .header-kejohanan { text-align: center; margin-bottom: 30px; }
    .header-kejohanan h1 { font-size: 2.2rem; margin: 0; color: var(--utama); text-transform: uppercase; text-shadow: 0 0 15px rgba(0,210,255,0.4); }

    .kawalan-utama { 
        background:var(--kad); padding:20px; border-radius:15px; 
        max-width: 1100px; margin: 0 auto 40px auto; border:1px solid var(--garis); 
    }
    .senarai-nama { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 12px; padding: 10px; }
    .input-kad { background: #000; padding: 12px; border-radius: 8px; border: 1px solid #444; }
    .input-pasukan { width: 92%; background: #111; border: 1px solid #333; color: #fff; padding: 6px; border-radius: 4px; margin-top: 6px; font-size: 0.8rem; }

    .tournament-layout { display: flex; flex-direction: column; gap: 50px; margin: 0 auto; width: fit-content; }
    .laluan-row { display: flex; gap: 40px; padding: 20px; background: rgba(255,255,255,0.02); border-radius: 15px; }
    .pusingan { display: flex; flex-direction: column; gap: 30px; min-width: 250px; justify-content: space-around; }
    
    .tajuk-pusingan { font-size: 0.75rem; font-weight: bold; text-align: center; padding: 8px; text-transform: uppercase; border-radius: 5px; margin-bottom: 10px; border: 1px solid #444; }

    /* KOTAK PERLAWANAN */
    .kotak-perlawanan { background:var(--kad); border:1px solid var(--garis); border-radius:10px; overflow:hidden; position: relative; padding-top: 25px; width: 260px; }
    .match-no { 
        position: absolute; top: 0; left: 0; background: rgba(0, 229, 255, 0.2); 
        color: var(--biru-nombor); font-size: 10px; font-weight: 900; padding: 3px 12px; 
        border-bottom-right-radius: 10px; border-right: 1px solid var(--biru-nombor); border-bottom: 1px solid var(--biru-nombor);
    }

    .slot-pasukan { display:flex; gap: 10px; align-items:center; padding:8px; border-bottom: 1px solid #222; height: 50px; }
    
    /* AVATAR DENGAN BORDER BIRU */
    .avatar-wrapper { 
        width: 42px; height: 42px; border-radius: 50%; 
        overflow: hidden; background: #222; flex-shrink: 0; 
        border: 2px solid var(--utama); /* Garis biru supaya nampak slot gambar */
        box-shadow: 0 0 5px rgba(0, 210, 255, 0.3);
    }
    .avatar { width: 100%; height: 100%; object-fit: cover; display: block; }

    .nama-display { flex:1; font-size:0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .skor { width:35px; height: 28px; text-align:center; background:#000; border:1px solid #444; color:#fff; border-radius:4px; font-weight:bold; }

    /* WARNA STATUS */
    .slot-menang { background: rgba(46, 204, 113, 0.1) !important; }
    .skor-menang { background: var(--menang) !important; color: #000 !important; }
    .skor-kalah { background: var(--kalah) !important; color: #fff !important; }
    .teks-menang { color: var(--menang) !important; }

    .gf-container { display: flex; align-items: center; padding-left: 50px; border-left: 3px dashed var(--garis); margin-left: 30px; }
    .grand-final { border: 3px solid var(--emas) !important; box-shadow: 0 0 25px rgba(255, 215, 0, 0.3); }
    
    button { background:var(--utama); color:#000; font-weight:bold; cursor:pointer; border-radius:6px; padding:10px 20px; border:none; }
</style>
</head>
<body>

<div class="header-kejohanan">
    <h1>BWF BADMINTON KELUARGA¬≤</h1>
    <p>SUPER SERIES 10</p>
</div>

<div class="kawalan-utama">
    <div style="text-align:center; margin-bottom:20px;">
        <label>JUMLAH PASUKAN:</label>
        <input type="number" id="bilPasukan" value="6" min="2" style="width:60px; background:#000; color:#fff; border:1px solid #444; padding:5px;">
        <button onclick="jana()">JANA BRACKET</button>
    </div>
    <div id="containerNama" class="senarai-nama"></div>
</div>

<div class="tournament-layout">
    <div style="display: flex;">
        <div id="bracketZone">
            <div id="barisW" class="laluan-row"></div>
            <div style="height: 60px;"></div> 
            <div id="barisL" class="laluan-row"></div>
        </div>
        <div class="gf-container">
            <div class="pusingan">
                <div class="tajuk-pusingan" style="background:var(--emas); color:#000; border:none;">üèÜ GRAND FINAL</div>
                <div id="gfBox"></div>
            </div>
        </div>
    </div>
</div>

<script>
let config = { n: 0, p2: 0, seeds: [] };
let infoPasukan = {};
let matchCount = 1;

// FUNGSI TUKAR LINK GOOGLE DRIVE (SUPER-FIX)
function fixDriveLink(url) {
    if (!url) return "";
    if (url.includes('drive.google.com')) {
        // Ekstrak ID daripada pelbagai format link Drive
        let parts = url.split('/d/');
        let id = "";
        if (parts.length > 1) {
            id = parts[1].split('/')[0];
        } else {
            let match = url.match(/id=([^&]+)/);
            if (match) id = match[1];
        }
        if (id) {
            // Gunakan thumbnail link yang lebih stabil untuk paparan web
            return `https://lh3.googleusercontent.com/u/0/d/${id}=w200-h200-p`;
        }
    }
    return url;
}

function jana() {
    config.n = parseInt(document.getElementById('bilPasukan').value);
    config.p2 = Math.pow(2, Math.ceil(Math.log2(config.n)));
    config.seeds = getSeededOrder(config.p2);
    infoPasukan = {};
    matchCount = 1;
    
    const container = document.getElementById('containerNama');
    container.innerHTML = '';
    for(let i=0; i<config.n; i++) {
        container.innerHTML += `
            <div class="input-kad">
                <label style="font-size:10px; color:var(--emas)">PASUKAN ${i+1}</label>
                <input type="text" class="input-pasukan" placeholder="Nama..." oninput="updateLive(${i}, 'nama', this.value)">
                <input type="text" class="input-pasukan" placeholder="URL Gambar / Drive..." oninput="updateLive(${i}, 'foto', this.value)">
            </div>`;
        infoPasukan[i] = { nama: `Pasukan ${i+1}`, foto: "" };
    }

    renderBracket();
}

function renderBracket() {
    document.getElementById('barisW').innerHTML = '';
    document.getElementById('barisL').innerHTML = '';
    document.getElementById('gfBox').innerHTML = '';
    matchCount = 1;

    const pLen = Math.log2(config.p2);
    // WINNERS
    for(let p=0; p<pLen; p++) {
        let col = document.createElement('div');
        col.className = 'pusingan';
        col.innerHTML = `<div class="tajuk-pusingan" style="color:var(--utama)">W. Round ${p+1}</div>`;
        for(let m=0; m < Math.pow(2, pLen-p-1); m++) col.appendChild(buatKotak('W', p, m));
        document.getElementById('barisW').appendChild(col);
    }
    // LOSERS
    let lTotal = (pLen - 1) * 2;
    for(let p=0; p<lTotal; p++) {
        let col = document.createElement('div');
        col.className = 'pusingan';
        col.innerHTML = `<div class="tajuk-pusingan" style="color:#ff6b6b">L. Round ${p+1}</div>`;
        let mCount = Math.pow(2, Math.floor((lTotal - p - 1) / 2));
        for(let m=0; m < mCount; m++) col.appendChild(buatKotak('L', p, m));
        document.getElementById('barisL').appendChild(col);
    }
    document.getElementById('gfBox').appendChild(buatKotak('GF', 0, 0, true));
    scanByes();
}

function buatKotak(j, p, m, gf=false) {
    const id = `${j}_${p}_${m}`;
    let div = document.createElement('div');
    div.className = 'kotak-perlawanan' + (gf ? ' grand-final' : '');
    div.id = id;

    let n1 = "Menunggu...", n2 = "Menunggu...";
    if (j === 'W' && p === 0) {
        let s1 = config.seeds[m * 2], s2 = config.seeds[m * 2 + 1];
        n1 = s1 < config.n ? `Pasukan ${s1 + 1}` : "BYE";
        n2 = s2 < config.n ? `Pasukan ${s2 + 1}` : "BYE";
    }

    div.innerHTML = `
        <div class="match-no">M${matchCount++}</div>
        <div class="slot-pasukan" id="${id}_s1">
            <div class="avatar-wrapper"><img class="avatar" id="${id}_img1" src=""></div>
            <span id="${id}_p1" class="nama-display">${n1}</span>
            <input type="number" class="skor" id="${id}_sc1" oninput="kira('${id}')">
        </div>
        <div class="slot-pasukan" id="${id}_s2">
            <div class="avatar-wrapper"><img class="avatar" id="${id}_img2" src=""></div>
            <span id="${id}_p2" class="nama-display">${n2}</span>
            <input type="number" class="skor" id="${id}_sc2" oninput="kira('${id}')">
        </div>`;
    return div;
}

function updateLive(index, jenis, nilai) {
    const asal = `Pasukan ${index + 1}`;
    let rujukan = infoPasukan[index][jenis] || asal;
    
    if (jenis === 'foto') nilai = fixDriveLink(nilai);
    infoPasukan[index][jenis] = nilai;

    document.querySelectorAll('.nama-display').forEach(el => {
        if (el.innerText === rujukan || el.innerText === asal) {
            let base = el.id.substring(0, el.id.length - 3);
            let num = el.id.slice(-1);
            if (jenis === 'nama') el.innerText = nilai || asal;
            if (jenis === 'foto') {
                let targetImg = document.getElementById(`${base}_img${num}`);
                if (targetImg) targetImg.src = nilai;
            }
        }
    });
}

function kira(id) {
    let sc1 = document.getElementById(id+'_sc1'), sc2 = document.getElementById(id+'_sc2');
    if (sc1.value === '' || sc2.value === '') return;
    let v1 = parseInt(sc1.value), v2 = parseInt(sc2.value);
    if (v1 === v2) return;

    let n1 = document.getElementById(id+'_p1'), n2 = document.getElementById(id+'_p2');
    let im1 = document.getElementById(id+'_img1'), im2 = document.getElementById(id+'_img2');
    
    let menang = v1 > v2 ? n1.innerText : n2.innerText;
    let fotoM = v1 > v2 ? im1.src : im2.src;
    let kalah = v1 > v2 ? n2.innerText : n1.innerText;
    let fotoK = v1 > v2 ? im2.src : im1.src;

    let [j, p, m] = id.split('_').map(x => isNaN(x) ? x : parseInt(x));
    if (j === 'W') {
        let nW = document.getElementById(`W_${p+1}_${Math.floor(m/2)}_p${(m%2)+1}`);
        let iW = document.getElementById(`W_${p+1}_${Math.floor(m/2)}_img${(m%2)+1}`);
        if (nW) { nW.innerText = menang; iW.src = fotoM; }
        else { document.getElementById('GF_0_0_p1').innerText = menang; document.getElementById('GF_0_0_img1').src = fotoM; }

        let tP = (p === 0) ? 0 : p * 2 - 1;
        let totalM = (config.p2 / 2);
        let flipM = (m < totalM/2) ? (m + totalM/2) : (m - totalM/2);
        let tM = (p === 0) ? Math.floor(flipM / 2) : m;
        let tS = (p === 0) ? (flipM % 2) + 1 : 2;
        let lN = document.getElementById(`L_${tP}_${tM}_p${tS}`);
        let lI = document.getElementById(`L_${tP}_${tM}_img${tS}`);
        if (lN) { lN.innerText = kalah; lI.src = fotoK; }
    } else if (j === 'L') {
        let np = p + 1, nm = (p % 2 === 0) ? m : Math.floor(m/2), ns = (p % 2 === 0) ? 1 : (m % 2) + 1;
        let nL = document.getElementById(`L_${np}_${nm}_p${ns}`);
        let iL = document.getElementById(`L_${np}_${nm}_img${ns}`);
        if (nL) { nL.innerText = menang; iL.src = fotoM; }
        else { document.getElementById('GF_0_0_p2').innerText = menang; document.getElementById('GF_0_0_img2').src = fotoM; }
    }
}

function scanByes() {
    document.querySelectorAll('.kotak-perlawanan').forEach(box => {
        let p1 = document.getElementById(box.id+'_p1'), p2 = document.getElementById(box.id+'_p2');
        let sc1 = document.getElementById(box.id+'_sc1'), sc2 = document.getElementById(box.id+'_sc2');
        if (p1.innerText.includes("BYE") && sc2.value === "") { sc1.value = 0; sc2.value = 1; kira(box.id); }
        if (p2.innerText.includes("BYE") && sc1.value === "") { sc1.value = 1; sc2.value = 0; kira(box.id); }
    });
}

function getSeededOrder(n) {
    let o = [0, 1];
    while (o.length < n) {
        let nO = [];
        for (let i = 0; i < o.length; i++) { nO.push(o[i]); nO.push(2 * o.length - 1 - o[i]); }
        o = nO;
    }
    return o;
}
jana();
</script>
</body>
</html>
